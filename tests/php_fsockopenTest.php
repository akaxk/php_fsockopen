<?php
namespace php_fsockopenTest;
use php_fsockopen;
use php_fsockopen\fsockopen;
use PHPUnit\Framework\TestCase;
class php_fsockopenTest extends TestCase{

  public function testGet(){
    $Url = "https://raw.githubusercontent.com/yakeing/php_fsockopen/master/tests/return";
    $Referer = "https://github.com";
    $Cookie = '_gat=1';
    $fs = new fsockopen();
    //$fs->AcceptEncoding = 'gzip';
    $fs->init(10,'tcp',true);
    $ret = $fs->GET($Url, $Referer, $Cookie);
    $this->assertTrue(is_array($ret));
    
	   echo gzinflate($ret['body']);
    echo "\n\n";
	   echo gzinflate(substr($ret['body'],10,-8));
    //$this->assertEquals('Hello world', trim($ret['body']));
    return $fs;
  }

  
    /**
  * @depends testGet
  */
  public function testPost($fs){
    $fs->AcceptEncoding = 'gzip';
    $fs->OnContinue = true; //HTTP/1.1 417 Expectation Failed / HTTP/1.1 100 Continue
    //$curl->  = '';
    $Url = "https://api.github.com/_private/browser/errors";
    $Referer = "https://github.com";
    $Cookie = '_gat=1';
    //$ContentType = 'application/json; charset=utf-8';
    $Content = '{"bucket":"github-js-reports","error":{"columnNumber":null,"fileName":null,"lineNumber":null,"message":"ReportingObserverError","stack":"Error: ReportingObserverError"},"url":"https://github.com/about"}';
    $ret = $fs->POST($Url, $Content, $Referer, $Cookie, $fs->Content_Type);
    var_dump($ret);
    //$this->assertEquals(200, $ret->StatusCode);
  }
}
